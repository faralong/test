"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1279],{41279:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ej});var i=a(37876),n=a(14232),o=a(64320),s=a(71278),l=a(92634),r=a(5241),d=a(59319),c=a(63845),p=a(62920);let g={src:"/_next/static/media/ana-bg-mobile.f7137cb5.webp",height:99,width:102,blurDataURL:"data:image/webp;base64,UklGRqIAAABXRUJQVlA4WAoAAAAQAAAABwAABwAAQUxQSEEAAAAAACWo38x+DwAl7P305diyW6z//fTl2Myz8f/98+TYzLPw+vjv4tfMs63t7OXc1cyzNNTU0c3Lw60GmqampaSgkABWUDggOgAAAPABAJ0BKggACAACQDglqAJ0AR//3tfGQAD++H7WW0c5s1nLYTTrnD30Hsf35tZeV+Ec4R/eN4IAAAA=",blurWidth:8,blurHeight:8};var h=a(35972);let A={src:"/_next/static/media/bell.9adc53dc.gif",height:1500,width:1500,blurWidth:0,blurHeight:0};var u=a(98477),x=a(56047),m=a(35402),f=a(4208),b=a(26875),y=a(70780);let w={src:"/_next/static/media/ana_sparkle.bff35e20.svg",height:18,width:19,blurWidth:0,blurHeight:0};var v=a(33884),S=a(53665),C=a(83515),I=a(40987),k=a(35474);let j={src:"/_next/static/media/new-chat-btn.1d20db8a.svg",height:32,width:32,blurWidth:0,blurHeight:0},_={src:"/_next/static/media/send-button.664459f5.svg",height:32,width:32,blurWidth:0,blurHeight:0},B={src:"/_next/static/media/mute-notif.fba24246.webp",height:64,width:65,blurDataURL:"data:image/webp;base64,UklGRpIAAABXRUJQVlA4WAoAAAAQAAAABwAABwAAQUxQSEEAAAAAAAABZV8AVQEACXRHSZc3AABXFgA2UjMAAGUAIGQAZAAAZQ9yAwBkAAB1dQsAAHAAA6hdfH5ycwEpLQVnZAMAAABWUDggKgAAALABAJ0BKggACAACQDglpAAC52UfAOAA/v36nbxGydwQFFxXr8UNQAAAAA==",blurWidth:8,blurHeight:8};var E=a(55727),R=a(28688),N=a(29359),T=a(35167),Q=a(34754),P=a(98684);let H=(0,P.i7)(["20%{background-position:0%   0%,50%  50%,100%  50%}40%{background-position:0% 100%,50%   0%,100%  50%}60%{background-position:0%  50%,50% 100%,100%   0%}80%{background-position:0%  50%,50%  50%,100% 100%}"]),U=(0,P.i7)(["0%{opacity:1;bottom:-100%;}95%{opacity:1;bottom:2px;}100%{opacity:1;bottom:2px;}"]),F=(0,P.i7)(["0%{bottom:2px;}100%{bottom:-100%;}"]);(0,P.i7)(["0%{opacity:0;bottom:-100%;}100%{opacity:1;bottom:2px;}"]);let O=(0,P.i7)(["0%{opacity:1;bottom:2px;}100%{opacity:0;bottom:-100%;}"]),W=P.Ay.div.withConfig({componentId:"sc-70526f39-0"})(["display:flex;width:316px;top:1%;right:32px;position:fixed;flex-direction:column;align-items:flex-start;justify-content:flex-end;gap:9px;border-radius:18px;border:1px solid #8C46FF;background:radial-gradient(61.12% 55.37% at 95.9% 97.64%,rgba(0,167,201,0.40) 0%,rgba(0,167,201,0.40) 100%),radial-gradient(57.17% 49.84% at 0% 66.39%,rgba(255,32,168,0.40) 0%,rgba(255,32,168,0.40) 100%),radial-gradient(54.88% 52.06% at 80.76% 25%,rgba(114,86,255,0.20) 0%,rgba(114,86,255,0.20) 100%),rgba(0,0,0,0.95);background:radial-gradient(61.12% 55.37% at 95.9% 97.64%,color(display-p3 0.0533 0.6424 0.7717 / 0.40) 0%,color(display-p3 0.0549 0.6431 0.7725 / 0.00) 100%),radial-gradient(57.17% 49.84% at 0% 66.39%,color(display-p3 1 0.2588 0.6471 / 0.40) 0%,color(display-p3 1 0.2588 0.6471 / 0.00) 100%),radial-gradient(54.88% 52.06% at 80.76% 25%,color(display-p3 0.4314 0.3412 0.9765 / 0.20) 0%,color(display-p3 0.4314 0.3412 0.9765 / 0.00) 100%),color(display-p3 0 0 0 / 0.95);backdrop-filter:blur(60px);opacity:0;z-index:1;"," .chat-bot-home-search &{@media (min-width:767px){min-height:350px;}}@media (max-width:1023px){right:2px;z-index:199;top:unset;}"," &.mobile-slide-up{opacity:0;animation-name:",";animation-duration:0.10s;animation-delay:0s;animation-fill-mode:forwards;}&.mobile-slide-down{opacity:1;bottom:2px;animation-name:",";animation-duration:0.4s;animation-fill-mode:forwards;}&.slide-up{opacity:1;&.nowbux-supported{top:50px;}}&.slide-down{opacity:1;bottom:2px;animation-name:",";animation-duration:0.4s;animation-fill-mode:forwards;}"],e=>{let{refreshBtnVisible:t}=e;return t&&(0,P.AH)(["right:78px;"])},e=>{let{isMobile:t}=e;return t&&(0,P.AH)(["right:2px;z-index:199;top:unset;"])},U,F,O),L=P.Ay.div.withConfig({componentId:"sc-70526f39-1"})(["display:flex;flex-direction:column;align-items:flex-start;padding:0px 16px 16px 16px;gap:12px;align-self:stretch;margin-top:auto;"]),M=P.Ay.p.withConfig({componentId:"sc-70526f39-2"})(["display:flex;align-items:center;gap:4px;color:#fff;font-size:14px;font-weight:700;line-height:150%;width:100%;img{.ana-unmute{","}}"],(0,T.Eg)(Q.Ay.t("anaUnmute"))),D=P.Ay.div.withConfig({componentId:"sc-70526f39-3"})(["border-bottom:1px solid rgba(255,255,255,0.1);width:100%;padding:12px 16px;.ana-header-icon{@media (max-width:1023px){bottom:0px;right:-20px;width:44px;height:44px;display:flex;justify-content:center;align-items:center;}@media (min-width:1024px){display:none;}}"]),G=P.Ay.div.withConfig({componentId:"sc-70526f39-4"})(["width:100%;display:flex;padding:12px 16px;flex-direction:column;align-items:flex-end;gap:16px;align-self:stretch;overflow:scroll;"]);P.Ay.div.withConfig({componentId:"sc-70526f39-5"})(["display:flex;justify-content:space-between;width:100%;button{&:hover{&:disabled{background:",";color:",";}}&:disabled{background:",";color:",";}}"],e=>{let{theme:t}=e;return t.colors.black10},e=>{let{theme:t}=e;return t.colors.white},e=>{let{theme:t}=e;return t.colors.black10},e=>{let{theme:t}=e;return t.colors.white}),P.Ay.div.withConfig({componentId:"sc-70526f39-6"})(["cursor:pointer;padding:5px;position:absolute;right:10px;top:12px;"]);let J=P.Ay.div.withConfig({componentId:"sc-70526f39-7"})(["display:flex;padding-bottom:",";justify-content:flex-end;gap:8px;align-self:stretch;"],e=>{let{theme:t}=e;return t.spacing.base4}),V=P.Ay.div.withConfig({componentId:"sc-70526f39-8"})(["display:flex;position:relative;max-width:350px;padding:10px 12px;flex-direction:column;align-items:flex-end;border-radius:16px 16px 0px 16px;border:1px solid rgba(255,255,255,0.00);border:1px solid color(display-p3 1 1 1 / 0.00);background:rgba(255,255,255,0.10);background:color(display-p3 1 1 1 / 0.10);gap:10px;&:after{content:'';position:absolute;bottom:-1px;right:-11px;width:10px;height:19px;background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='19' viewBox='0 0 10 19' fill='none'%3E%3Cpath d='M0 19H10C5.40412 19 1.5557 15.5181 1.09726 10.9451L0 0V19Z' fill='white' fill-opacity='0.1' style='fill:white;fill-opacity:0.1;'/%3E%3C/svg%3E\");}"," p{overflow:hidden;text-overflow:ellipsis;color:",";margin:0;}"],v.cP,e=>{let{theme:t}=e;return t.colors.white70}),z=P.Ay.div.withConfig({componentId:"sc-70526f39-9"})(["min-height:auto;max-height:none;overflow-y:auto;display:flex;flex-direction:column;gap:8px;align-items:flex-end;"]);P.Ay.div.withConfig({componentId:"sc-70526f39-10"})(["width:30px;align-self:flex-start;aspect-ratio:2;--_g:no-repeat radial-gradient(circle closest-side,rgba(0,0,0,0.2) 90%,#0000);background:var(--_g) 0% 50%,var(--_g) 50% 50%,var(--_g) 100% 50%;background-size:calc(100% / 3) 50%;background-color:rgba(0,0,0,0.1);animation:",' 1s infinite linear;border-radius:6px;position:relative;&::before{content:"";position:absolute;top:15px;left:2px;border-top:5px solid rgba(0,0,0,0.1);border-left:5px solid transparent;border-right:5px solid transparent;}'],H);let Z=P.Ay.span.withConfig({componentId:"sc-70526f39-11"})(["color:#fff;color:color(display-p3 1 1 1);font-size:14px;font-style:normal;font-weight:400;line-height:150%;"]);P.Ay.div.withConfig({componentId:"sc-70526f39-12"})(["display:flex;flex-wrap:wrap;gap:8px;"]);let Y=P.Ay.div.withConfig({componentId:"sc-70526f39-13"})(["width:100%;display:flex;flex-direction:column;gap:4px;padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,0.5);background:rgba(0,0,0,0.2);&:hover{border-radius:12px;border:1px solid rgba(255,255,255,0.70);background:rgba(0,0,0,0.20);box-shadow:0px 2px 8px 0px rgba(0,0,0,0.04);}&:focus{border:1px solid #FF00AB;}&:active:not(:disabled){border:1px solid #FF00AB;}box-shadow:0px 2px 8px 0px rgba(0,0,0,0.04);.send-chat-btn{height:32px;background:none;border:none;padding:0;cursor:pointer;&:focus{outline:none;}&:hover:not(:disabled){border-radius:6px;background:rgba(255,255,255,0.20);background:color(display-p3 1 1 1 / 0.20);box-shadow:0px 8px 16px 0px rgba(0,0,0,0.10);}&:active:not(:disabled){background-color:#FF42A5;}&:disabled{cursor:not-allowed;opacity:0.5;}}.new-chat-btn{position:relative;height:32px;background:none;border:none;padding:0;cursor:pointer;&:focus{outline:none;}&:hover{border-radius:6px;background:rgba(255,255,255,0.20);background:color(display-p3 1 1 1 / 0.20);box-shadow:0px 8px 16px 0px rgba(0,0,0,0.10);:after{opacity:1;visibility:visible;}}:after{content:attr(data-title);width:90px;position:absolute;top:20%;left:85%;margin-left:10px;padding:4px 6px;color:#fff;font-size:10px;text-align:center;opacity:0;visibility:hidden;transition:opacity 0.3s,visibility 0.3s;border-radius:4px;border:1px solid rgba(255,255,255,0.20);border:1px solid color(display-p3 1 1 1 / 0.20);background:rgba(0,0,0,0.80);}}img{cursor:pointer;}"]),q=P.Ay.input.withConfig({componentId:"sc-70526f39-14"})(['background:none;border:none;flex-grow:1;outline:none;height:21px;color:#FFF;font-family:"Bricolage Grotesque";font-size:14px;font-style:normal;font-weight:400;line-height:150%;']),X=P.Ay.span.withConfig({componentId:"sc-70526f39-15"})(["color:rgba(255,255,255,0.70);color:color(display-p3 1 1 1 / 0.70);text-align:center;font-size:10px;font-style:normal;font-weight:400;line-height:normal;letter-spacing:0.2px;display:flex;justify-content:center;align-items:center;width:100%;"]),K=P.Ay.div.withConfig({componentId:"sc-70526f39-16"})(["position:relative;width:100%;height:40px;"]),$=P.Ay.div.withConfig({componentId:"sc-70526f39-17"})(["position:absolute;top:20px;left:2px;transform:translateY(-50%);width:24px;height:24px;overflow:hidden;border-radius:50%;"]),ee=P.Ay.video.withConfig({componentId:"sc-70526f39-18"})(["position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:50.09px;height:28.17px;object-fit:cover;"]),et=P.Ay.div.withConfig({componentId:"sc-70526f39-19"})(["position:absolute;top:0;left:0;width:100%;height:100%;background-image:",";background-size:cover;"],e=>"url(".concat(e.bgImg,")")),ea={src:"/_next/static/media/ana-loader-mask.2277a64a.webp",height:1,width:1,blurDataURL:"data:image/webp;base64,UklGRkgAAABXRUJQVlA4WAoAAAAQAAAABwAABwAAQUxQSAkAAAABBxAREYiI/gcAVlA4IBgAAAAwAQCdASoIAAgAAkA4JaQAA3AA/vucwAA=",blurWidth:8,blurHeight:8},ei=()=>(0,i.jsx)(K,{children:(0,i.jsxs)($,{children:[(0,i.jsx)(ee,{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,children:(0,i.jsx)("source",{src:p.v42,type:"video/mp4"})}),(0,i.jsx)(et,{bgImg:(0,h._w)(ea)})]})});var en=a(87581),eo=a(52944);let es={src:"/_next/static/media/playnow-icon.a3dd66a4.svg",height:16,width:16,blurWidth:0,blurHeight:0},el={src:"/_next/static/media/ana-chat-icon.3100fe5e.webp",height:24,width:24,blurDataURL:"data:image/webp;base64,UklGRroAAABXRUJQVlA4WAoAAAAQAAAABwAABwAAQUxQSD4AAAABV6CQjSQ4ubv3qxzEYV1EBJZf5WcaqIkkKSowQXoZQlABCijCE8EngfwdxRH9D6nRKvgN5cN8sA4kBSchG1ZQOCBWAAAAEAIAnQEqCAAIAAJAOCWwAnQGKl5KwL5GAAD+q7MKV06u/x/4WuQT4T8hmH328m7tKBx4vDQ2N3YkcY5jk1zhm5avngOqPcaZY3PZN5s8F1cv0NZ3EAA=",blurWidth:8,blurHeight:8};var er=a(19786);let ed={src:"/_next/static/media/tenor_logo.07499b00.svg",height:16,width:44,blurWidth:0,blurHeight:0},ec=P.Ay.div.withConfig({componentId:"sc-98654388-0"})(["display:flex;align-items:flex-end;gap:8px;align-self:stretch;"]),ep=P.Ay.div.withConfig({componentId:"sc-98654388-1"})(["display:flex;flex-direction:column;align-items:flex-start;flex:1 0 0;border-radius:16px 16px 16px 0px;border:1px solid rgba(255,255,255,0);background:linear-gradient(0deg,rgba(255,255,255,0.20) 0%,rgba(255,255,255,0.20) 100%),linear-gradient(270deg,rgba(255,255,255,0.05) 0%,rgba(255,255,255,0.05) 99.48%);"]),eg=P.Ay.div.withConfig({componentId:"sc-98654388-2"})(["padding:10px 16px;position:relative;&.show-caret{&:after{content:'';position:absolute;left:-10px;bottom:-1px;width:9px;height:19px;background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='19' viewBox='0 0 10 19' fill='none'%3E%3Cpath d='M10 19H0C4.59588 19 8.4443 15.5181 8.90274 10.9451L10 0V19Z' fill='white' fill-opacity='0.2' style='fill:white;fill-opacity:0.2;'/%3E%3C/svg%3E\");}}"]),eh=P.Ay.div.withConfig({componentId:"sc-98654388-3"})(["display:flex;position:relative;padding:12px;align-items:flex-start;gap:10px;align-self:stretch;border-radius:0px 0px 16px 0px;border-top:1px solid rgba(255,255,255,0.1);background:linear-gradient(270deg,rgba(255,255,255,0.10) 0%,rgba(255,255,255,0.10) 99.48%);background:linear-gradient(270deg,color(display-p3 1 1 1 / 0.00) 0%,color(display-p3 1 1 1 / 0.00) 99.48%);&:last-child{border-radius:0px 0px 16px 0px;&:after{content:'';position:absolute;left:-10px;bottom:-1px;width:9px;height:19px;background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='19' viewBox='0 0 10 19' fill='none'%3E%3Cpath d='M10 19H0C4.59588 19 8.4443 15.5181 8.90274 10.9451L10 0V19Z' fill='white' fill-opacity='0.2' style='fill:white;fill-opacity:0.2;'/%3E%3C/svg%3E\");}}"]),eA=P.Ay.p.withConfig({componentId:"sc-98654388-4"})(["color:rgba(255,255,255,0.70);font-size:12px;font-style:normal;font-weight:600;line-height:120%;"]),eu=P.Ay.div.withConfig({componentId:"sc-98654388-5"})(["position:relative;margin-left:40px;align-self:flex-start;.tenor-img{position:absolute;bottom:11px;left:9px;height:10px;}"]),ex=e=>{let{content:t,ctaList:a,gifUrl:n}=e,{t:o}=(0,b.B)(),s="".concat(p.Cpe,"placeholder-image.jpg");return(0,i.jsxs)(i.Fragment,{children:[n&&(0,i.jsxs)(eu,{children:[(0,i.jsx)("img",{src:n,alt:"",height:"200",style:{width:"100%"}}),(0,i.jsx)("img",{className:"tenor-img",src:(0,h._w)(ed),alt:""})]}),(0,i.jsxs)(ec,{children:[(0,i.jsx)("img",{className:"ana-chat-img",style:{width:24,height:24},src:(0,h._w)(el),alt:"ana bot icon"}),(0,i.jsxs)(ep,{children:[(0,i.jsx)(eg,{style:(null==a?void 0:a.length)?{}:{borderRadius:"20px 20px 20px 0px"},className:(null==a?void 0:a.length)?"":"show-caret",children:(0,i.jsx)(v.M5,{children:t})}),(null==a?void 0:a.length)>0&&a.map(e=>(0,i.jsxs)(eh,{children:[(0,i.jsx)("img",{style:{borderRadius:"12px"},src:e.ctaIconUrl||s,alt:"",width:60,height:60}),(0,i.jsxs)(eo.Fp,{children:[(0,i.jsx)(eA,{children:e.ctaName}),(0,i.jsx)("a",{href:(0,er.Ay)(e.ctaUrl,"AnaChatBot"),target:"_self",style:{textDecoration:"none"},onClick:()=>(0,r.sx)("ChatBotPlayNowClicked",{packageName:e.packageName,chatSessionId:sessionStorage.getItem(p.TQ4)||"",element:e.element||"chatBox"}),children:(0,i.jsxs)(en.$,{variant:"primary",children:[(0,i.jsx)(v.le,{children:o("playNow")}),(0,i.jsx)("img",{src:(0,h._w)(es),alt:"",width:16})]})})]})]}))]})]})]})};var em=a(15171),ef=function(e,t,a,i){return new(a||(a=Promise))(function(n,o){function s(e){try{r(i.next(e))}catch(e){o(e)}}function l(e){try{r(i.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?n(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(s,l)}r((i=i.apply(e,t||[])).next())})};let eb=e=>{let{onClose:t,wrapperRef:a,startSessionOnRender:d=!1,reaction:g}=e,{t:A}=(0,b.B)(),u=(0,n.useContext)(c.A),[T,Q]=(0,n.useState)(null),[P,H]=(0,n.useState)(""),[U,F]=(0,n.useState)(""),[O,K]=(0,n.useState)(""),[$,ee]=(0,n.useState)([]),et=(0,o.wA)(),[ea,en]=(0,n.useState)(!1),eo=(0,n.useRef)(null),es=(0,o.d4)(e=>e.user.userMsgFromSearch),el=(0,o.d4)(e=>e.user.searchBarOpened),er=(0,o.d4)(e=>e.play.anaSpectatingGameplay),ed=(0,o.d4)(e=>e.play.muteAnaSpectateMessages),ec=(0,o.d4)(e=>e.play.aiSessionUpdateInProgress),ep=(0,o.d4)(e=>e.play.isAnnouncementBarVisible),eg=(0,o.d4)(e=>e.play.chatHistory),eh=(0,o.d4)(e=>e.auth.isLoggedIn),eA=u.isHomePage,eu=(0,n.useMemo)(()=>!!(eg.length>1)||!!$.length,[eg.length,$.length]);function eb(e){let t={uaId:(0,x.qk)(p.kk8),uaSessionId:(0,x.Rm)(p.J0m),chatSessionId:sessionStorage.getItem(p.TQ4)||"",appId:u.appInfo.appId,content:e||P,feDeviceType:(0,x.el)().feDeviceType,element:e?"searchBar":s.A.getState().play.isPlayerLoaded?"gamePlay":"chatBox",packageName:u.appInfo.packageName,gameName:u.appInfo.appName};return(0,x.ZZ)()&&s.A.getState().play.robloxExperienceId.toString()&&(t=Object.assign(Object.assign({},t),{robloxExperienceId:s.A.getState().play.robloxExperienceId.toString()})),f.Ay.updateAiChat({},t)}(0,n.useEffect)(()=>{es&&($.push({type:"human",content:es}),ee($),en(!0),eb(es).then(e=>{(e.status===m.vd.Success||e.status===m.vd.FailureRateLimitExceeded)&&(en(!1),$.push({type:"ai",content:e.botResponse}),ee($))}).catch(e=>{}),et({type:l.A.SHOW_ANA_BOT,payload:{showAnaBot:!1}}),et({type:l.A.UPDATE_USER_AND_DEVICE_DATA,payload:{userMsgFromSearch:""}}))},[es]),(0,n.useEffect)(()=>{F(""),!(0,x.Fr)()||(0,x.v1)()||(0,x.bh)()?(0,x.v1)()||(0,x.bh)()?K("slide-up"):(0,x.xl)()&&K("slide-up"):K("mobile-slide-up");let e=eh?(0,C.VM)():null;return e&&Q(e),(0,r.sx)("ChatBotPopUpDisplayed",{chatSessionId:sessionStorage.getItem(p.TQ4)||""}),(eA||d||er)&&(0,x.kC)(),()=>{(0,x.kC)()}},[]),(0,n.useEffect)(()=>{eg.length>0||$.length>0?et({type:l.A.SHOW_ANA_BOT,payload:{showAnaBot:!1}}):eA||et({type:l.A.SHOW_ANA_BOT,payload:{showAnaBot:!0}});let e=eo.current;e&&(e.scrollTop=e.scrollHeight)},[JSON.stringify(eg),JSON.stringify($)]);let ey=()=>ef(void 0,void 0,void 0,function*(){P&&!ea&&($.push({type:"human",content:P}),ee($),en(!0),eb().then(e=>{var t;(null==(t=e.botResponse)?void 0:t.answer)!==""&&(en(!1),$.push({type:"ai",content:e.botResponse}),ee($))}).catch(e=>{en(!1)}),et({type:l.A.SHOW_ANA_BOT,payload:{showAnaBot:!1}}),H(""))});return(0,i.jsxs)(W,{ref:a,className:"\n        ".concat(O," ").concat(U,"\n        ").concat(ep?"nowbux-supported":"","\n      "),isMobile:!(0,x.xl)(),refreshBtnVisible:!(0,x.Fr)()&&!(0,N.a2)()&&(u.isAppPage||u.isPlayPage||!1),style:{height:eu?"calc(100% - ".concat(el&&(0,x.Fr)()?"2%":(0,x.Fr)()||(0,x.v1)()?"0%":el&&(0,x.Fr)()?"100%":(0,x.xl)()?"10%":"110px",")"):"fit-content",justifyContent:"unset",borderRadius:"".concat(el||(0,x.Fr)()&&eu?"0px":"18px")},children:[(0,i.jsx)(D,{children:(0,i.jsx)(S.Zl,{gap:"8",children:(0,i.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:(0,i.jsxs)(M,{style:eg.length>0||$.length>0?{margin:0}:{margin:window.screen.availWidth<1024?"8px 0px 0px 0px":"0px 0px 8px 0px"},children:[A("helloIAmAna"),(0,i.jsx)("div",{style:{flex:1},children:(0,i.jsx)("img",{src:(0,h._w)(w),alt:"AnaSparkle",className:"ana-icon-sparkle",width:"18",height:"18"})}),er&&ed&&(0,i.jsx)(em.Oi,{className:"rounded unmute",style:{cursor:"pointer",marginRight:"4px"},onClick:()=>{et({type:y.A.UPDATE_ANA_BOT_STATE,payload:{muteAnaSpectateMessages:!1}})},children:(0,i.jsx)("img",{src:(0,h._w)(B),alt:"unmute",width:"18",height:"18"})}),(0,i.jsx)(em.Oi,{className:"close",onClick:()=>{!(0,x.Fr)()||(0,x.v1)()||(0,x.bh)()?(0,x.v1)()||(0,x.bh)()?F("slide-down"):(0,x.xl)()&&F("slide-down"):F("mobile-slide-down"),setTimeout(()=>{t()},1500)},children:(0,i.jsx)(E.b,{style:{color:R.JX.colors.white70},size:16})})]})})})}),(0,i.jsxs)(G,{children:[(eg.length>0||$.length>0)&&(0,i.jsxs)(z,{ref:eo,children:[eg.length>0&&(0,i.jsx)(i.Fragment,{children:eg.map(e=>"human"===e.type?e.data.additional_kwargs.messageType&&"Image"===e.data.additional_kwargs.messageType?null:(0,i.jsxs)(J,{children:[(0,i.jsx)(V,{children:(0,i.jsx)(v.M5,{children:e.data.content})}),(0,i.jsx)(I.Mf,{className:"chat-box-avatar",isLoggedIn:eh,children:(0,i.jsx)(k.A,{id:"ng-profile",isLoggedIn:eh,user:T,src:null==T?void 0:T.avatar,click:()=>{},size:24})})]}):(0,i.jsx)(ex,{content:e.data.content,gifUrl:e.data.additional_kwargs.gifUrl||"",ctaList:(e=>e?JSON.parse(e.replace(/\\"/g,'"')):[])((null==e?void 0:e.data.additional_kwargs.cta)||"")}))}),$.length>0&&(0,i.jsx)(i.Fragment,{children:$.map(e=>{let{content:t,type:a}=e;return"human"===a?(0,i.jsxs)(J,{children:[(0,i.jsx)(V,{children:(0,i.jsx)(v.M5,{children:t})}),(0,i.jsx)(I.Mf,{className:"chat-box-avatar",isLoggedIn:eh,children:(0,i.jsx)(k.A,{id:"ng-profile",isLoggedIn:eh,user:T,src:null==T?void 0:T.avatar,click:()=>{},size:24})})]}):(0,i.jsx)(ex,{gifUrl:(null==t?void 0:t.gifUrl)||"",content:null==t?void 0:t.answer,ctaList:null==t?void 0:t.ctaList})})}),ea&&(0,i.jsx)(ei,{})]}),0===eg.length&&0===$.length&&(0,i.jsx)(Z,{children:A("anaGreetingText")})]}),(0,i.jsxs)(L,{children:[(0,i.jsxs)(Y,{children:[(0,i.jsx)(q,{placeholder:"Ask me anything",value:P,onKeyUp:e=>e.stopPropagation(),onKeyDown:e=>e.stopPropagation(),onFocus:()=>ef(void 0,void 0,void 0,function*(){0!==eg.length||0!==$.length||eA||(0,x.kC)()}),onChange:e=>H(e.target.value),onKeyPress:e=>{"Enter"===e.key&&ey()}}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[($.length>0||eg.length>0)&&(0,i.jsx)("button",{"data-title":"Start New Chat",className:"new-chat-btn",onClick:()=>ef(void 0,void 0,void 0,function*(){(0,r.sx)("ChatBotReset",{chatSessionId:sessionStorage.getItem(p.TQ4)||""}),eA||et({type:l.A.SHOW_ANA_BOT,payload:{showAnaBot:!0}}),sessionStorage.removeItem(p.TQ4),et({type:y.A.SET_CHAT_HISTORY,payload:{chatHistory:[]}}),ee([]),H(""),eA&&(0,x.kC)()}),children:(0,i.jsx)("img",{src:(0,h._w)(j),alt:"new-chat-btn",height:"32",width:"32"})}),(0,i.jsx)("button",{style:{marginLeft:"auto"},className:"send-chat-btn",disabled:!P||ea||ec,onClick:()=>ey(),children:(0,i.jsx)("img",{src:(0,h._w)(_),alt:"send-chat-btn",height:"32",width:"32"})})]})]}),(0,i.jsx)(X,{children:A("anaDisclaimer")})]})]})},ey={src:"/_next/static/media/messages.3f4b24fc.webp",height:96,width:97,blurDataURL:"data:image/webp;base64,UklGRqQAAABXRUJQVlA4WAoAAAAQAAAABwAABwAAQUxQSDoAAAABYBRJkqI6hhc6IAfMTC/0b+biPETEBPDrHtM0TYfVqABm0ahL5M9G0agARpFbHy+WuveZplpEPPkCVlA4IEQAAACQAQCdASoIAAgAAkA4JaQAAp0gc4AA4n65RdMl5BZxGaNLYWNR6z7dgLV8YrXATHtY9Ok8JtbAL1kHYK8X9gmvOOAAAA==",blurWidth:8,blurHeight:8},ew={src:"/_next/static/media/tick.26c97726.webp",height:64,width:64,blurDataURL:"data:image/webp;base64,UklGRmoAAABXRUJQVlA4WAoAAAAQAAAABwAABwAAQUxQSCwAAAABYFNbW5tHX1HG1A0ggIOAlC1r1sitEiJiAngvwt2Y4KEvAq7YDgW4/bT8CVZQOCAYAAAAMAEAnQEqCAAIAAJAOCWkAANwAP77IYAA",blurWidth:8,blurHeight:8},ev=e=>{let{onClose:t,wrapperRef:a,reaction:s,onMsgClick:l,anaRef:d}=e,{t:g}=(0,b.B)(),A=(0,n.useContext)(c.A),[u,m]=(0,n.useState)(""),f=(0,o.wA)(),w=(0,o.d4)(e=>e.play.anaSpectatingGameplay),S=(0,o.d4)(e=>e.play.muteAnaSpectateMessages),C=(0,o.d4)(e=>e.play.anaNotifResponded),I=(0,o.d4)(e=>e.play.isPlayerLoaded),k=!(0,x.xl)(),j=(0,n.useCallback)(e=>{f({type:y.A.UPDATE_ANA_BOT_STATE,payload:{anaSpectatingGameplay:e}}),(0,r.sx)("ChatBotSpectatePopUpClicked",{chatSessionId:sessionStorage.getItem(p.TQ4)||"",allowed:e}),f({type:y.A.UPDATE_ANA_BOT_STATE,payload:{anaNotifResponded:!0}})},[f,t]);return(0,n.useEffect)(()=>{m(""),C||(0,r.sx)("ChatBotSpectatePopUpDisplayed",{chatSessionId:sessionStorage.getItem(p.TQ4)||""})},[]),(0,n.useEffect)(()=>{S&&t()},[S]),(0,i.jsx)(em.uM,{ref:a,className:"".concat(u,"\n        ").concat(C||w||k&&I?"ana-spectating":""),isMobileMenu:k&&I,refreshBtnVisible:!(0,x.Fr)()&&!(0,N.a2)()&&(A.isAppPage||A.isPlayPage||!1),style:k&&I?{left:68,top:0,width:384,borderRadius:60,transform:"translate(0px, 10px)",maxWidth:"calc(100vw - 86px)"}:{},children:C||w||k&&I?(0,i.jsxs)(em.X8,{children:[(0,i.jsxs)(em.nA,{onClick:l,children:[(0,i.jsx)(em.Oi,{className:"messages",children:(0,i.jsx)("img",{src:(0,h._w)(ey),alt:""})}),(0,i.jsx)(v.E2,{children:C?w?s||g("anaWatchMsg"):g("anaNoSpectate"):g("anaSpectatePrompt")})]}),(0,i.jsx)(em.Oi,{className:"rounded mute",onClick:()=>{f({type:y.A.UPDATE_ANA_BOT_STATE,payload:{muteAnaSpectateMessages:!0}})},children:(0,i.jsx)("img",{src:(0,h._w)(B),alt:""})}),k&&I&&!w&&!C&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(em.wv,{}),(0,i.jsx)(em.Oi,{className:"rounded yes",onClick:()=>{j(!0)},children:(0,i.jsx)("img",{src:(0,h._w)(ew),alt:""})})]}),(0,i.jsx)(em.Oi,{className:"rounded ".concat(w||C?"close":"no"),onClick:w||C?t:()=>{j(!1)},children:(0,i.jsx)(E.b,{style:{color:R.JX.colors.white70},size:16})})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(v.M5,{children:g("anaSpectatePrompt")}),(0,i.jsxs)(em.G,{mobileMenu:(0,x.Qb)()&&I,children:[(0,i.jsx)(en.$,{size:"small",variant:"defaultOutline",onClick:()=>{j(!1)},children:g("no")}),(0,i.jsx)(en.$,{size:"small",variant:"primary",onClick:()=>{j(!0)},children:g("yes")})]})]})})};var eS=a(5480),eC=function(e,t,a,i){return new(a||(a=Promise))(function(n,o){function s(e){try{r(i.next(e))}catch(e){o(e)}}function l(e){try{r(i.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?n(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(s,l)}r((i=i.apply(e,t||[])).next())})};let eI="".concat(p.Cpe,"/assets/images/ana-icon.webp"),ek="".concat(p.Cpe,"/assets/videos/ana-exp.webm"),ej=()=>{let[e,t]=(0,n.useState)(!1),[a,w]=(0,n.useState)(!1),v=(0,o.d4)(e=>e.user.userMsgFromSearch),S=(0,o.d4)(e=>e.user.hideAnaBotChat),C=(0,o.d4)(e=>e.play.anaSpectatingGameplay);(0,o.d4)(e=>e.play.muteAnaSpectateMessages);let I=(0,o.d4)(e=>e.play.isPlayerLoaded),k=(0,o.d4)(e=>e.ads.adsEnded),j=(0,o.d4)(e=>e.auth.showPreloader),_=(0,o.d4)(e=>e.play.isAndroidConnected),B=(0,o.d4)(e=>e.play.anaNotifResponded),E=(0,o.d4)(e=>e.play.showMobileHeaderFooter),{t:R}=(0,b.B)(),[N,T]=(0,n.useState)(""),Q=(0,n.useRef)(null),P=(0,o.wA)(),H=(0,n.useContext)(c.A),U=H.isHomePage,F=(0,n.useRef)(null),O=(0,n.useRef)(null),W=(0,n.useRef)(!1),L=(0,n.useRef)(!1),[M,D]=(0,n.useState)(!1),G=(0,n.useRef)(null),J=(0,n.useRef)(null),V=navigator.maxTouchPoints>0?"pointerdown":"pointermove",z=()=>eC(void 0,void 0,void 0,function*(){if(J.current)try{J.current.muted=!0,J.current.hasAttribute("playsinline")||J.current.setAttribute("playsinline","");let e=J.current.play();void 0!==e&&(yield e)}catch(e){(0,d.Ay)(Error("Failed to play ana-exp video"),{error:e})}finally{document.removeEventListener(V,z)}});(0,n.useEffect)(()=>(document.addEventListener(V,z,{once:!0}),()=>{document.removeEventListener(V,z)}),[]),(0,n.useEffect)(()=>{L.current=e},[e]);let Z=(0,n.useCallback)(()=>{var e;let t=document.createElement("canvas"),a=t.getContext("2d"),i=null==(e=s.A.getState().play.videoRef)?void 0:e.current,n=s.A.getState().play.orientation,o=s.A.getState().play.isPlayerLoaded;return i&&o?(n===m.QB.landscape?(0,x.Fr)()?(t.width=i.clientHeight,t.height=i.clientWidth,null==a||a.rotate(-Math.PI/2),null==a||a.drawImage(i,-t.width/2,0,t.height,t.width)):(t.width=i.clientHeight,t.height=i.clientWidth,null==a||a.translate(t.width/2,t.height/2),null==a||a.rotate(-Math.PI/2),null==a||a.drawImage(i,-t.height/2,-t.width/2,t.height,t.width)):(t.width=i.clientWidth,t.height=i.clientHeight,null==a||a.drawImage(i,0,0,i.clientWidth,i.clientHeight)),t.toDataURL("image/jpeg").split(";base64,")[1]):""},[s.A.getState().play.videoRef,s.A.getState().play.orientation,s.A.getState().play.isPlayerLoaded]),Y=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return eC(void 0,void 0,void 0,function*(){var a,i,n;let o=Z();if(!o&&!e||!document.hasFocus)return;sessionStorage.getItem(p.TQ4)||(yield eC(void 0,void 0,void 0,function*(){var e;let t={status:m.vd.Failure,botSessionData:{}},a={uaId:(0,x.qk)(p.kk8),uaSessionId:(0,x.Rm)(p.J0m)};(t=yield f.Ay.startAiChatSession({},a)).status===m.vd.Success&&sessionStorage.setItem(p.TQ4,null==(e=t.botSessionData)?void 0:e.chatSessionId)}));let l={uaId:(0,x.qk)(p.kk8),uaSessionId:(0,x.Rm)(p.J0m),appId:H.appInfo.appId,chatSessionId:sessionStorage.getItem(p.TQ4)||"",feDeviceType:(0,x.el)().feDeviceType,element:"gamePlay",base64Image:o||"FirstCall",packageName:H.appInfo.packageName,gameName:H.appInfo.appName,playSessionId:H.playSessionId||"NA",feSessionId:window.feSessionId||"",ntmSource:sessionStorage.getItem("ntmSource")||"NA",isFirstCall:e};(0,x.ZZ)()&&s.A.getState().play.robloxExperienceId.toString()&&(l=Object.assign(Object.assign({},l),{robloxExperienceId:s.A.getState().play.robloxExperienceId.toString()}));let r=yield f.Ay.analyzeBotScreenshot({},l);if(r.status===m.vd.Success&&(null==(a=r.botResponse)?void 0:a.answer)){let e=[...s.A.getState().play.chatHistory,{type:"ai",data:{additional_kwargs:{cta:JSON.stringify(r.botResponse.ctaList),gifUrl:r.botResponse.gifUrl},tool_calls:[],response_metadata:{},invalid_tool_calls:[],content:r.botResponse.answer}}];if(P({type:y.A.SET_CHAT_HISTORY,payload:{chatHistory:e}}),T(null==(i=r.botResponse)?void 0:i.answer),!s.A.getState().play.muteAnaSpectateMessages&&s.A.getState().play.anaSpectatingGameplay&&!L.current){let e;w(!0),t(!1),D(!1),yield(e=null==(n=r.botResponse)?void 0:n.answer,eC(void 0,void 0,void 0,function*(){let t=new URLSearchParams;t.append("text_input",e),t.append("text_filtering","standard"),t.append("character_voice_gen","female_03.wav"),t.append("language","en"),t.append("output_file_name","output_audio"),t.append("output_file_timestamp","true");let a=yield fetch("https://audio.testngg.net/api/tts-generate",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t}),i=yield a.json();G.current&&i.output_file_url&&(G.current.src="https://audio.testngg.net".concat(i.output_file_url))}))}}})};(0,n.useEffect)(()=>{C&&setTimeout(()=>eC(void 0,void 0,void 0,function*(){yield Y(!0),setInterval(()=>eC(void 0,void 0,void 0,function*(){yield Y(!1)}),1e3*(H.appInfo.playFeFeatures.aiBotScreenshotFrequencySecs||60))}),2e4)},[C]);let q=(0,n.useCallback)(a=>{(!s.A.getState().play.anaSpectatingGameplay||e)&&F.current&&!F.current.contains(a.target)&&O.current&&!O.current.contains(a.target)&&(t(!1),D(!1))},[s.A.getState().play.anaSpectatingGameplay,e]);(0,n.useEffect)(()=>(e&&document.addEventListener("mousedown",q),()=>{document.removeEventListener("mousedown",q)}),[e]),(0,n.useEffect)(()=>{let a=()=>{e||W.current||(t(!0),W.current=!0)};return H.isHomePage&&((0,x.Qb)()?window.addEventListener("scroll",a,!0):setTimeout(()=>{t(!0)},2e3)),U||P({type:l.A.SHOW_ANA_BOT,payload:{showAnaBot:!0}}),()=>{window.removeEventListener("scroll",a,!0)}},[]),(0,n.useEffect)(()=>{!(!I||(0,x.Fr)())&&k&&!j&&_&&H.appInfo.playFeFeatures.enableAiScreenshot&&(w(!0),t(!1),D(!1))},[I,k,j,_]);let X=(0,n.useCallback)(()=>{t(e=>!e),w(!1)},[t]);(0,n.useEffect)(()=>{v&&X()},[v]);let K=(0,n.useCallback)(()=>{(0,r.sx)("ChatBotClosed",{chatSessionId:sessionStorage.getItem(p.TQ4)||""}),t(!1),w(!1),D(!1),P({type:l.A.SHOW_ANA_BOT,payload:{showAnaBot:!0}})},[P,t,w,D,r.sx]),$=(0,n.useCallback)(()=>{t(!1),w(!1),D(!0),t(!0)},[t,w,D]);return(0,i.jsxs)(eS.Ay,{className:"".concat(S?"hide ":"").concat(U?"home":""),id:"anahandler",bg:(0,h._w)(g),ref:Q,mobileMenu:!(0,x.xl)()&&I,children:[(0,i.jsx)("audio",{id:"sound",controls:!0,autoPlay:!0,ref:G}),!E&&(0,i.jsxs)(eS.P7,{id:"collapse-ana",ref:O,onClick:X,mobileMenu:!(0,x.xl)()&&I,children:[(0,i.jsx)("video",{ref:J,poster:eI,preload:"auto",muted:!0,loop:!0,playsInline:!0,src:ek,className:"ana-exp"}),!(0,x.xl)()&&I&&!e&&!a&&!C&&!B&&H.appInfo.playFeFeatures.enableAiScreenshot&&(0,i.jsx)("img",{src:(0,h._w)(A),alt:"",className:"ana-bell",onClick:e=>{e.stopPropagation(),w(!0)}})]}),(0,i.jsxs)(i.Fragment,{children:[e&&!a&&((0,x.xl)()?(0,i.jsx)(eb,{wrapperRef:F,onClose:K,startSessionOnRender:M,reaction:N}):(0,u.createPortal)((0,i.jsx)(eb,{wrapperRef:F,onClose:K,startSessionOnRender:M,reaction:N}),document.body)),a&&(0,i.jsx)(ev,{wrapperRef:F,anaRef:Q,onClose:K,reaction:N,onMsgClick:$})]})]})}}}]);
//# sourceMappingURL=1279.d7c94434c9207abb.js.map